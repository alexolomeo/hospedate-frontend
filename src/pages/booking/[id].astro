---
import ProtectedLayout from '@/layouts/ProtectedLayout.astro';
import BookingBase from '@/components/React/Booking/BookingBase';
import { detectLanguage, getTranslation } from '@/utils/i18n';
import type { ParamsListingAvailibility } from '@/types/listing/listing';

const lang = detectLanguage(Astro.request.headers, new URL(Astro.request.url));
const t = getTranslation(lang);
const title = t.booking.pageTitles.dashboard;
const { id } = Astro.params;
const searchParams = Astro.url.searchParams;

const checkInDate = searchParams.get('checkInDate');
const checkOutDate = searchParams.get('checkoutDate');
const adults = searchParams.get('adults');
const getNumericParam = (p: string) => {
  const n = Number(searchParams.get(p));
  return Number.isFinite(n) ? n : 0;
};

if (!id || !checkInDate || !checkOutDate || !adults) {
  return new Response(null, { status: 404 });
}

const params: ParamsListingAvailibility = {
  checkInDate,
  checkoutDate: checkOutDate,
  adults: Number(adults),
  children: getNumericParam('children'),
  infants: getNumericParam('infants'),
  pets: getNumericParam('pets'),
};
---

<ProtectedLayout title={title} requires={{ registerCompleted: true }}>
  <div
    class="mx-auto max-w-4xl px-5 pt-8 pb-22 md:max-w-5xl lg:max-w-5xl xl:max-w-5xl 2xl:max-w-7xl"
  >
    <BookingBase client:idle lang={lang} listingId={id} params={params} />
  </div>
</ProtectedLayout>
